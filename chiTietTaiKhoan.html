<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    </head>
    <style>
        .nen {
            background-color: rgba(0, 0, 0, 0.4); /* Màu nền với độ trong suốt 60% */
            }
            body {
                background-image: url('https://i0.wp.com/thatnhucuocsong.com.vn/wp-content/uploads/2022/01/tai-anh-7-vien-ngoc-rong.jpg');
                background-size: cover;
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-position: center;
            }
            .co {
                max-width: 1200px;
            }
            .tacvu {
                color: #ffffff;
                font-weight: 700;
            }
            .tacvu:hover {
                color: #311fd0;
            }
            h2{
                color: #ffffff;
            }
            
            .khung{
                background-color: #ffffff;  
                border-radius: 6px;
                
            }
            .modal {

                background-color: rgba(0, 0, 0, 0.5);
                justify-content: center;
            }

            /* Nội dung bên trong modal */
            .modal-content {
                margin-top: 100px;
                padding: 20px;
                width: 700px;
                height: 500px;
                /* Ensure responsiveness on smaller screens */
            }
            .close-button {
                position: absolute;
                top: -10px;
                right: -10px;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                font-weight: bold;
                padding: 0;
            }
            
    </style>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark nen">
            <div class="container co mx-auto">
                <a class="navbar-brand" href="#">
                    <img src="anhshopvip.png" style="height: 100px; width: 200px;" class="img-fluid" alt="Logo">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a id="btn_trang_chu" class="nav-link tacvu" href="index.html">TRANG CHỦ</a>
                        </li>
                        <li class="nav-item">
                            <a id="btn_nap_tien" class="nav-link tacvu" href="dang_nhap.html">NẠP TIỀN</a>
                        </li>
                        <li class="nav-item">
                            <a id="btn_dich_vu" class="nav-link tacvu" href="DichVu.html">DỊCH VỤ</a>
                        </li>
                        <li class="nav-item">
                            <a id="btn_shop_acc" class="nav-link tacvu" href="shopAccNRO.html">NIK GAME</a>
                        </li>
                        <li class="nav-item">
                            <a id="btn_dang_nhap" class="nav-link tacvu border border-secondary rounded" href="dang_nhap.html"><i class="bi bi-person"></i> ĐĂNG NHẬP</a>
                        </li>
                        <li class="nav-item">
                            <a id="btn_dang_ky" class="nav-link tacvu border border-secondary rounded" href="dangKyTaiKhoan.html"><i class="bi bi-key"></i> ĐĂNG KÝ</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="col co mx-auto nen mt-3 py-4">
            <h2 class="text-center">THÔNG TIN ACC NRO</h2>
            <div style="width: 100px; height: 1px; margin: 20px auto; border-bottom: 4px solid #e90606;"></div>
            <div class="w-100 px-auto">
                <div class="mx-auto row px-0" id="chiTietAcc"></div>
            </div>
        </div>
        <div style="background-color: #2f353b; height: 500px">
            <div class="row co mx-auto mt-3 py-4" style="background-color: #2f353b;">
                <div class="col-md-5 p-4" style="color: #5c6873;">HỆ THỐNG BÁN ACC NGỌC RỒNG TỰ ĐỘNG - ĐẢM BẢO UY TÍN VÀ CHẤT LƯỢNG.</div>
                <div class="col-md-5 p-4" style="color: #5c6873;">CHÚNG TÔI LUÔN LẤY UY TÍN LÀM HÀNG ĐẦU ĐỐI VỚI KHÁCH HÀNG. HI VỌNG SẼ ĐƯỢC PHỤC VỤ CÁC BẠN. CẢM ƠN!</div>
            </div>
        </div>
        <div class="modal" id="myModal">
            <div class="modal-content">
                <button type="button" class="close-button btn btn-primary" onclick="closeModal()">X</button>
                <h4 style="text-align: center;">CHI TIẾT GIAO DỊCH</h4>
                <hr>
                <div>
                    <div id="thong_tin_TK"></div>
                </div>
                <hr>
                <div>
                    <strong style="color: red;">THANH TOÁN</strong>
                    <div id="thanh_toan"></div>
                </div>
                <div class="d-flex justify-content-center mt-4">
                    <a href="dang_nhap.html" id="xac_nhan_mua" style="width: 150px" class="btn btn-success">ĐĂNG NHẬP</a>
                </div>
                <h2></h2>
            </div>
        </div>
        <script>
            $(document).ready(function() {
                // Lấy ID từ URL
                const urlParams = new URLSearchParams(window.location.search);
                const accountId = urlParams.get('id');
                console.log(accountId);
                const id2 = urlParams.get('id2');
                console.log(id2);
                
                // Kiểm tra ID có tồn tại
                if(accountId){
                    $.get("http://localhost:3000/nicknro/" + accountId, function(data, status) {
                        
                        $('#chiTietAcc').empty(); // Xóa các kết quả cũ

                        var item = data; // Nếu đây là một tài khoản duy nhất
                        var veHTML = '<div class="text-center">';

                        veHTML += '<h2 style="color: #f65959;"><strong style="color: #ffffff;">THÔNG TIN TÀI KHOẢN: </strong><strong>' + item.id + ' </strong></h2>';

                        veHTML += '<div class="row justify-content-center">';
                            veHTML += '<div style="width: 150px; background-color: #0096ff; color: #ffffff;" class="khung col-form-label text-center">GIÁ: ' + item.gia + '</div>';
                            veHTML += '<div class="col-md-2"></div>'
                            veHTML += '<a id="mua" onclick="openModal()" style="width: 150px" class="btn btn-success col-form-label text-center">MUA</a>';
                        veHTML += '</div>';

                        veHTML += '<div style="width: 100%; height: 1px; margin: 20px auto; border-bottom: 4px solid #52eb4c;"></div>'
                        veHTML += '<div class="row d-flex justify-content-center">';
                            veHTML += '<p style="color: #e90606;" class="col-6 col-md-3"><strong style="color: #ffffff;">Đăng ký:</strong> <strong>' + (item.dangky === "dang_ky_ao" ? 'Ảo' : 'Chính chủ') + '</strong></p>';

                            veHTML += '<p style="color: #e90606;" class="col-6 col-md-3"><strong style="color: #ffffff;">Hành tinh:</strong> <strong>' + (item.hanhtinh === "trai_dat" ? 'Trái Đất' : item.hanhtinh === "namec" ? 'Namec' : 'Xayda') + '</strong></p>';

                            veHTML += '<p style="color: #e90606;" class="col-6 col-md-3"><strong style="color: #ffffff;">Server:</strong> <strong>' + (item.server === "server_1" ? 'Server 1' : item.server === "server_2" ? 'Server 2' : item.server === "server_3" ? 'Server 3' : item.server === "server_4" ? 'Server 4' : item.server === "server_5" ? 'Server 5' : item.server === "server_6" ? 'Server 6' : 'Server 7') + '</strong></p>';

                            veHTML += '<p style="color: #e90606;" class="col-6 col-md-3"><strong style="color: #ffffff;">Loại acc:</strong> <strong>' + (item.loaiacc === "so_sinh" ? 'Sơ Sinh' : item.loaiacc === "tam_trung" ? 'Tầm trung' : item.loaiacc === "vip" ? 'Vip' : 'Win DT') + '</strong></p>';
                            veHTML += '<p style="color: #e90606;" class="col-6 col-md-3"><strong style="color: #ffffff;">Bông tai:</strong> <strong>' + (item.bongtai === "khong" ? 'Không' : 'Có') + '</strong></p>';
                        veHTML += '</div>';
                        veHTML += '<div style="width: 100%; height: 1px; margin: 20px auto; border-bottom: 4px solid #52eb4c;"></div>'

                        if(item.soanh > 0){
                            veHTML += '<img src="' + item.anh1 + '" alt="" class="col-md-9 col-11 py-3">';
                        }
                        if(item.soanh > 1){
                            veHTML += '<img src="' + item.anh2 + '" alt="" class="col-md-9 col-11 py-3">';
                        }
                        if(item.soanh > 2){
                            veHTML += '<img src="' + item.anh3 + '" alt="" class="col-md-9 col-11 py-3">';
                        }
                        if(item.soanh > 3){
                            veHTML += '<img src="' + item.anh4 + '" alt="" class="col-md-9 col-11 py-3">';
                        }
                        veHTML += '</div>';
                        $('#chiTietAcc').append(veHTML); 
                        

                        $('#thong_tin_TK').empty(); // Xóa các kết quả cũ
                        var veHTML = '<p style="color: #f65959;"><strong style="color: red;">THÔNG TIN TÀI KHOẢN: </strong><strong id="maAcc">' + item.id + ' </strong></p>';
                        veHTML += '<table class="col-12">';
                            veHTML += '<tr style="background: #e0e0e0">';
                                veHTML += '<th class="col-6">Đăng ký:</th>';
                                veHTML += '<td id="dangky" class="col-6">' + (item.dangky === "dang_ky_ao" ? 'Ảo' : 'Chính chủ') + '</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr>';
                                veHTML += '<th class="col-6">Hành tinh:</th>';
                                veHTML += '<td id="hanhtinh" class="col-6">' + (item.hanhtinh === "trai_dat" ? 'Trái Đất' : item.hanhtinh === "namec" ? 'Namec' : 'Xayda') + '</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr style="background: #e0e0e0">';
                                veHTML += '<th class="col-6">Server:</th>';
                                veHTML += '<td id="server" class="col-6">' + (item.server === "server_1" ? 'Server 1' : item.server === "server_2" ? 'Server 2' : item.server === "server_3" ? 'Server 3' : item.server === "server_4" ? 'Server 4' : item.server === "server_5" ? 'Server 5' : item.server === "server_6" ? 'Server 6' : 'Server 7') + '</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr>';
                                veHTML += '<th class="col-6">Loại acc:</th>';
                                veHTML += '<td id="loaiacc" class="col-6">' + (item.loaiacc === "so_sinh" ? 'Sơ Sinh' : item.loaiacc === "tam_trung" ? 'Tầm trung' : item.loaiacc === "vip" ? 'Vip' : 'Win DT') + '</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr style="background: #e0e0e0">';
                                veHTML += '<th class="col-6">Bông tai:</th>';
                                veHTML += '<td id="bongtai" class="col-6">' + (item.bongtai === "khong" ? 'Không' : 'Có') + '</td>';
                            veHTML += '</tr>';
                        veHTML += '</table>'; 
                        $('#thong_tin_TK').append(veHTML);


                        $('#thanh_toan').empty(); // Xóa các kết quả cũ    
                        var veHTML = '<table class="col-12">';
                            veHTML += '<tr style="background: #e0e0e0">';
                                veHTML += '<th class="col-6">Giá tiền:</th>';
                                veHTML += '<td id="gia" class="col-6">' + item.gia + '</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr>';
                                veHTML += '<th class="col-6">Giảm giá:</th>';
                                veHTML += '<td class="col-6">0</td>';
                            veHTML += '</tr>';
                            veHTML += '<tr style="background: #e0e0e0">';
                                veHTML += '<th class="col-6">Tổng thanh toán:</th>';
                                veHTML += '<td id="tong_tien" class="col-6">'+ item.gia +'</td>';
                            veHTML += '</tr>';
                        veHTML += '</table>';
        
                       
                        $('#thanh_toan').append(veHTML);

                    });
                } else {
                    $('#chiTietAcc').html('<p style="color: red; font-weight: 600;">Không tìm thấy ID tài khoản trong URL.</p>');
                }
                // Nếu có id, kiểm tra tài khoản và thay đổi nút
                if (id2) {
                    $.get("http://localhost:3000/taikhoan/" + id2, function(data, status){
                        if (data) {
                            $('#btn_dang_nhap').replaceWith('<div id="so_du" class="nav-link tacvu border border-secondary rounded">SỐ DƯ: ' + data.so_du + ' VNĐ</div>');
                            $('#btn_dang_ky').replaceWith('<button id="btn_dang_xuat" class="nav-link tacvu border border-secondary rounded" onclick="dangXuat()">ĐĂNG XUẤT</button>');
                            $('#btn_trang_chu').replaceWith('<a id="btn_trang_chu" class="nav-link tacvu" href="trangchubanacc.html?id='+ id2 +'">TRANG CHỦ</a>');
                            $('#btn_nap_tien').replaceWith('<a id="btn_nap_tien" class="nav-link tacvu" href="napThe.html?id='+ id2 +'">NẠP TIỀN</a>');
                            $('#btn_dich_vu').replaceWith('<a id="btn_dich_vu" class="nav-link tacvu" href="DichVu.html?id='+ id2 +'">DỊCH VỤ</a>');
                            $('#btn_shop_acc').replaceWith('<a id="btn_shop_acc" class="nav-link tacvu" href="shopAccNRO.html?id='+ id2 +'">NIK GAME</a>');
                            $('#xac_nhan_mua').replaceWith('<a id="xac_nhan_mua" onclick="thanhToan(\''+id2+'\')" style="width: 150px" class="btn btn-success">XÁC NHẬN</a>')
                        }
                    });
                }
            });
           
            function dangXuat(){
                var xac_nhan = confirm('bạn có muốn đăng xuất không');
                if(xac_nhan){
                    // Xóa ID khỏi URL
                    window.history.pushState({}, document.title, window.location.pathname);
                    alert('Đăng xuất thành công');
                    window.location.href = 'trangchubanacc.html';
                }
                else{
                    alert('Đã hủy đăng xuất')
                }     
            }
            function openModal() {
                document.getElementById("myModal").style.display = "flex";
            }

            function closeModal() {
                document.getElementById("myModal").style.display = "none";
            }

            function thanhToan(id){
                var tong_tien = $('#tong_tien').text();
                $.get("http://localhost:3000/taikhoan", function(data, status){
                    data.forEach(function(item){
                        if(id === item.id){
                            var soDuMoi = parseFloat(item.so_du) - parseFloat(tong_tien);
                            if(soDuMoi<0){
                                alert('Số dư của bạn khong đủ để thực hiện giao dịch');
                                return;
                            }
                            item.so_du = soDuMoi.toString();
                            console.log(item.so_du);
                            $.ajax({
                                url: 'http://localhost:3000/taikhoan/'+ item.id,
                                type: 'PUT',
                                data: JSON.stringify(item),
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function(response) {
                                    alert('Thanh toán thành công');

                                    nikDaMua(id)
                                },
                                error: function(xhr, status, error) {
                                    console.error('Lỗi:', error);
                                    alert('Đã xảy ra lỗi khi thanh toán.');
                                }
                                
                            });
                        }
                        
                    });
                });
                
            }
            
            function nikDaMua(id){
                var gia = $('#gia').text();
                var dangky = $('#dangky').text();
                var hanhtinh = $('#hanhtinh').text();
                var server = $('#server').text();
                var loaiacc = $('#loaiacc').text();
                var bongtai = $('#bongtai').text();
                var maAcc = $('#maAcc').text();
                var maTK = id;
                var data = {
                    gia: gia,
                    dangky: dangky,
                    hanhtinh: hanhtinh,
                    server: server,
                    loaiacc: loaiacc,
                    bongtai: bongtai,
                    maAcc: maAcc,
                    maTK: maTK
                };
                console.log('Lỗi:',id);
                $.ajax({
                    url: 'http://localhost:3000/nikDaMua',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        TK_MK(maAcc);
                        xoaNik(maAcc);
                        
                    },
                    error: function (xhr, status, error) {
                        console.error('Lỗi:', error);
                        alert('Đã xảy ra lỗi.');
                        return
                    }
                });
            }
            function TK_MK(id){
                $.get("http://localhost:3000/nicknro/" + id, function(data, status){
                        if (data) {
                            alert('Tai khoan:'+data.TK)
                            alert('Mật khẩu:'+data.MK)
                        }
                    });
            }
            function xoaNik(id){
                console.log(id)
                $.ajax({
                    url: 'http://localhost:3000/nicknro/' + id,
                    type: 'DELETE',
                    success: function (response) {
                        lamMoiTrang()
                    },
                    error: function (xhr, status, error) {
                        console.error('Lỗi:', error);
                        alert('Đã xảy ra lỗi khi xóa nik.');
                    }
                });
            }
            function lamMoiTrang() {
                location.reload();
            }
        </script>
    </body>
</html>
